<navigation-bar></navigation-bar>

<!-- Breadcrumbs -->
<div class="breadcrumbs">
  <div class="container">
      <a routerLink="/"><i class="fas fa-home mr-1"></i></a>/
      Ολοκλήρωση Αγοράς
  </div>
</div>

<!-- Checkout -->
<section  class="checkout">
<div class="container">
  <h1 class="text-center">Ολοκλήρωση Αγοράς</h1>

  <div class="row mt-5">
    <div class="col-sm-7">
        <form (ngSubmit)="f.form.valid && onSubmit()" id="ngForm" #f="ngForm" novalidate>
            <h4>Email</h4>

             <div class="form-group">
                <label>Email</label>
                <input type="email" name="email" class="form-control" [(ngModel)]="orderDetails.email" #email="ngModel" [ngClass]="{'is-invalid' : f.submitted &&  email.invalid}" required email>
                <div *ngIf="f.submitted && email.invalid" class="invalid-feedback">
                    <div *ngIf="email.errors.required">Πρέπει να συμπληρώσετε το email</div>
                    <div *ngIf="email.errors.email">Το email πρέπει να έχει τη σωστή μορφή</div>
                </div>
            </div>

            <h4 class="mt-4 mb-3">Διεύθυνση αποστολής</h4>

            <div class="form-group">
               <label>Όνομα</label>
               <input type="text" name="firstname" class="form-control" [(ngModel)]="orderDetails.shipping_info.first_name" #firstname="ngModel" [ngClass]="{'is-invalid' : f.submitted && firstname.invalid}" required minlength="2">
               <div *ngIf="f.submitted && firstname.invalid" class="invalid-feedback">
                <div *ngIf="firstname.errors.required">Πρέπει να συμπληρώσετε το όνομα</div>
                <div *ngIf="firstname.errors.minlength">Το όνομα πρέπει να έχει μήκος τουλάχιστον δύο χαρακτήρες</div>
               </div>
            </div>

            <div class="form-group">
               <label>Επίθετο</label>
               <input type="text" name="lastname" class="form-control" [(ngModel)]="orderDetails.shipping_info.last_name" #lastname="ngModel" [ngClass]="{'is-invalid' : f.submitted && lastname.invalid}" required minlength="2">
               <div *ngIf="f.submitted && lastname.invalid" class="invalid-feedback">
                 <div *ngIf="lastname.errors.required">Πρέπει να συμπληρώσετε το επίθετο</div>
                 <div *ngIf="lastname.errors.minlength">Το επίθετο πρέπει να έχει μήκος τουλάχιστον δύο χαρακτήρες</div>
               </div>
            </div>

            <div class="form-group">
               <label>Διεύθυνση</label>
               <input type="text" name="street" class="form-control" [(ngModel)]="orderDetails.shipping_info.street" #street="ngModel" [ngClass]="{'is-invalid' : f.submitted && street.invalid}" required minlength="2">
               <div *ngIf="f.submitted && street.invalid" class="invalid-feedback">
                <div *ngIf="street.errors.required">Πρέπει να συμπληρώσετε την διέυθυνση</div>
                <div *ngIf="street.errors.minlength">Η διεύθυνση πρέπει να έχει μήκος τουλάχιστον δύο χαρακτήρες</div>
              </div>
            </div>

            <div class="form-group">
               <label>Ταχυδρομικός κώδικας</label>
               <input type="number" name="postcode" class="form-control" [(ngModel)]="orderDetails.shipping_info.post_code" #postcode="ngModel" [ngClass]="{'is-invalid' : f.submitted && postcode.invalid}" required>
               <div *ngIf="f.submitted && postcode.invalid" class="invalid-feedback">
                 <div *ngIf="postcode.errors.required">Πρέπει να συμπληρώσετε τον ταχυδρομικό κώδικα</div>
              </div>
           </div>

           <div class="form-group">
               <label>Πόλη</label>
               <input type="text" name="city" class="form-control" [(ngModel)]="orderDetails.shipping_info.city" #city="ngModel" [ngClass]="{'is-invalid' : f.submitted && city.invalid}" required minlength="2">
               <div *ngIf="f.submitted && city.invalid" class="invalid-feedback">
                <div *ngIf="city.errors.required">Πρέπει να συμπληρώσετε την πόλη</div>
                <div *ngIf="city.errors.minlength">Η πόλη πρέπει να έχει μήκος τουλάχιστον δύο χαρακτήρες</div>
              </div>
            </div>

            <div class="form-group">
               <label>Τηλέφωνο</label>
               <input type="number" name="phone" class="form-control" [(ngModel)]="orderDetails.shipping_info.phone" #phone="ngModel" [ngClass]="{'is-invalid' : f.submitted && phone.invalid}" required tel>
               <div *ngIf="f.submitted && phone.invalid" class="invalid-feedback">
                <div *ngIf="phone.errors.required">Πρέπει να συμπληρώσετε το τηλέφωνο</div>
                <div *ngIf="phone.errors.phone">Το τηλέφωνο πρέπει να έχει τη σωστή μορφή</div>
               </div>
           </div>

           <h4 class="mt-4 mb-3">Μέθοδοι αποστολής</h4>

           <table class="table">
                <tbody>
                    <tr>
                        <td class="radio-button"><input type="radio" name="shipping-cost" [checked] ="isCourierChecked" (change)="changeShippingCost()"></td>
                        <td class="shipping-price">2€</td>
                        <td class="shipping-method">Courier</td>
                    </tr>
                    <tr>
                        <td class="radio-button"><input type="radio" name="shipping-cost" [checked] ="!isCourierChecked" (change)="changeShippingCost()"></td>
                        <td class="shipping-price">0€</td>
                        <td class="shipping-method">Παραλαβή από το κατάστημα</td>
                    </tr>
                </tbody>
           </table>

           <h4 class="mt-4 mb-3">Μέθοδοι πληρωμής</h4>

           <div class="billing-method"><input type="radio" checked="checked"><span>Αντικαταβολή</span></div>

           <h4 class="mt-4 mb-3">Διεύθυνση πληρωμής</h4>

           <div class="same-address"><input type="checkbox" [checked] = "orderDetails.isShippingAddressSameWithBillingAddress" 
            (change)="changeisShippingAddressSameWithBillingAddress()"> 
            Η διεύθυνση πληρωμής είναι ίδια με την διεύθυνση αποστολής</div>

            <section *ngIf="!orderDetails.isShippingAddressSameWithBillingAddress" class="billing-address">
                    <div class="form-group">
                      <label>Όνομα</label>
                      <input type="text" name="bfirstname" class="form-control" [(ngModel)]="orderDetails.billing_info.first_name" #bfirstname="ngModel" [ngClass]="{'is-invalid' : f.submitted && bfirstname.invalid}" required minlength="2">
                      <div *ngIf="f.submitted && bfirstname.invalid" class="invalid-feedback">
                        <div *ngIf="bfirstname.errors.required">Πρέπει να συμπληρώσετε το όνομα</div>
                        <div *ngIf="bfirstname.errors.minlength">Το όνομα πρέπει να έχει μήκος τουλάχιστον δύο χαρακτήρες</div>
                      </div>
                    </div>
            
                    <div class="form-group">
                      <label>Επίθετο</label>
                      <input type="text" name="blastname" class="form-control" [(ngModel)]="orderDetails.billing_info.last_name" #blastname="ngModel" [ngClass]="{'is-invalid' : f.submitted && blastname.invalid}" required minlength="2">
                      <div *ngIf="f.submitted && blastname.invalid" class="invalid-feedback">
                        <div *ngIf="blastname.errors.required">Πρέπει να συμπληρώσετε το επίθετο</div>
                        <div *ngIf="blastname.errors.minlength">Το επίθετο πρέπει να έχει μήκος τουλάχιστον δύο χαρακτήρες</div>
                      </div>
                    </div>
            
                    <div class="form-group">
                      <label>Διεύθυνση</label>
                      <input type="text" name="bstreet" class="form-control" [(ngModel)]="orderDetails.billing_info.street" #bstreet="ngModel" [ngClass]="{'is-invalid' : f.submitted && bstreet.invalid}" required minlength="2">
                      <div *ngIf="f.submitted && bstreet.invalid" class="invalid-feedback">
                        <div *ngIf="bstreet.errors.required">Πρέπει να συμπληρώσετε την διέυθυνση</div>
                        <div *ngIf="bstreet.errors.minlength">Η διεύθυνση πρέπει να έχει μήκος τουλάχιστον δύο χαρακτήρες</div>
                      </div>
                    </div>
            
                    <div class="form-group">
                      <label>Ταχυδρομικός κώδικας</label>
                       <input type="number" name="bpostcode" class="form-control" [(ngModel)]="orderDetails.billing_info.post_code" #bpostcode="ngModel" [ngClass]="{'is-invalid' : f.submitted && bpostcode.invalid}" required>
                       <div *ngIf="f.submitted && bpostcode.invalid" class="invalid-feedback">
                        <div *ngIf="bpostcode.errors.required">Πρέπει να συμπληρώσετε τον ταχυδρομικό κώδικα</div>
                      </div>
                    </div>

                    <div class="form-group">
                        <label>Πόλη</label>
                        <input type="text" name="bcity" class="form-control" [(ngModel)]="orderDetails.billing_info.city" #bcity="ngModel" [ngClass]="{'is-invalid' : f.submitted && bcity.invalid}" required minlength="2">
                        <div *ngIf="f.submitted && bcity.invalid" class="invalid-feedback">
                         <div *ngIf="bcity.errors.required">Πρέπει να συμπληρώσετε την πόλη</div>
                         <div *ngIf="bcity.errors.minlength">Η πόλη πρέπει να έχει μήκος τουλάχιστον δύο χαρακτήρες</div>
                       </div>
                     </div>
            
                    <div class="form-group">
                      <label>Τηλέφωνο</label>
                      <input type="number" name="bphone" class="form-control" [(ngModel)]="orderDetails.billing_info.phone" #bphone="ngModel" [ngClass]="{'is-invalid' : f.submitted && bphone.invalid}" required tel>
                      <div *ngIf="f.submitted && bphone.invalid" class="invalid-feedback">
                        <div *ngIf="bphone.errors.required">Πρέπει να συμπληρώσετε το τηλέφωνο</div>
                        <div *ngIf="bphone.errors.phone">Το τηλέφωνο πρέπει να έχει τη σωστή μορφή</div>
                      </div>
                    </div>
            </section>
        </form>   

    </div>

    <div class="col-sm-5">
        <h4 class="text-center">Περίληψη Παραγγελίας</h4>

        <div class="summary mt-4">
            <div><span class="title ">Υποσύνολο</span> <span class="price">{{getTotalCartPrice()}}€</span></div>
            <div><span class="title">Μεταφορικά</span> <span class="price">{{shippingCost}}€</span></div>
            <div id="total"><span class="title">Συνολο</span> <span class="price">{{getTotalCartPrice() + shippingCost}}€</span></div>
        </div>
        <button class="btn btn-block btn-primary mt-2" form="ngForm" [disabled] = "!isAddOrderRequestDone" >Ολοκλήρωση αγοράς</button>

        <h5>Καλάθι</h5>

        <div *ngFor="let cartProduct of cartProducts" class="row cart-item">
            <div class="col-sm-4">
                <img class="d-block mx-auto" src="{{cartProduct?.imageUrl}}" alt="img"/>
            </div>
            <div class="col-sm-8">
                <div class="product-name">{{cartProduct?.name}}</div>
                <div class="product-price">{{cartProduct?.price}} €</div>
                <div class="product-quantity">Ποσότητα : <span>{{cartProduct?.quantity}}</span></div>
            </div>
        </div>
    </div>

  </div>

  <i *ngIf="!isAddOrderRequestDone" class="fas fa-sync-alt fa-2x fa-spin spinner" ></i>

</div>  
</section>

<my-footer></my-footer>
